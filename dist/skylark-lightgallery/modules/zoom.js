/**
 * skylark-lightgallery - The skylark album widgets.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-jquery","../light-gallery"],function(t,e){"use strict";var o,a,r={scale:1,zoom:!0,actualSize:!0,enableZoomAfter:300,useLeftForZoom:(o=!1,a=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),a&&parseInt(a[2],10)<54&&(o=!0),o)},i=function(e){return this.core=t(e).data("lightGallery"),this.core.s=t.extend({},r,this.core.s),this.core.s.zoom&&this.core.doCss()&&(this.init(),this.zoomabletimeout=!1,this.pageX=t(window).width()/2,this.pageY=t(window).height()/2+t(window).scrollTop()),this};i.prototype.init=function(){var e=this,o='<button type="button" aria-label="Zoom in" id="lg-zoom-in" class="lg-icon"></button><button type="button" aria-label="Zoom out" id="lg-zoom-out" class="lg-icon"></button>';e.core.s.actualSize&&(o+='<button type="button" aria-label="Actual size" id="lg-actual-size" class="lg-icon"></button>'),e.core.s.useLeftForZoom?e.core.$outer.addClass("lg-use-left-for-zoom"):e.core.$outer.addClass("lg-use-transition-for-zoom"),this.core.$outer.find(".lg-toolbar").append(o),e.core.$el.on("onSlideItemLoad.lg.tm.zoom",function(o,a,r){var i=e.core.s.enableZoomAfter+r;t("body").hasClass("lg-from-hash")&&r?i=0:t("body").removeClass("lg-from-hash"),e.zoomabletimeout=setTimeout(function(){e.core.$slide.eq(a).addClass("lg-zoomable")},i+30)});var a=1,r=function(o){var a=e.core.$outer.find(".lg-current .lg-image"),r=(t(window).width()-a.prop("offsetWidth"))/2,i=(t(window).height()-a.prop("offsetHeight"))/2+t(window).scrollTop(),s=(o-1)*(e.pageX-r),n=(o-1)*(e.pageY-i);a.css("transform","scale3d("+o+", "+o+", 1)").attr("data-scale",o),e.core.s.useLeftForZoom?a.parent().css({left:-s+"px",top:-n+"px"}).attr("data-x",s).attr("data-y",n):a.parent().css("transform","translate3d(-"+s+"px, -"+n+"px, 0)").attr("data-x",s).attr("data-y",n)},i=function(){a>1?e.core.$outer.addClass("lg-zoomed"):e.resetZoom(),a<1&&(a=1),r(a)},s=function(o,r,s,n){var l,g=r.prop("offsetWidth");l=e.core.s.dynamic?e.core.s.dynamicEl[s].width||r[0].naturalWidth||g:e.core.$items.eq(s).attr("data-width")||r[0].naturalWidth||g,e.core.$outer.hasClass("lg-zoomed")?a=1:l>g&&(a=l/g||2),n?(e.pageX=t(window).width()/2,e.pageY=t(window).height()/2+t(window).scrollTop()):(e.pageX=o.pageX||o.originalEvent.targetTouches[0].pageX,e.pageY=o.pageY||o.originalEvent.targetTouches[0].pageY),i(),setTimeout(function(){e.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")},10)},n=!1;e.core.$el.on("onAferAppendSlide.lg.tm.zoom",function(t,o){var a=e.core.$slide.eq(o).find(".lg-image");a.on("dblclick",function(t){s(t,a,o)}),a.on("touchstart",function(t){n?(clearTimeout(n),n=null,s(t,a,o)):n=setTimeout(function(){n=null},300),t.preventDefault()})}),t(window).on("resize.lg.zoom scroll.lg.zoom orientationchange.lg.zoom",function(){e.pageX=t(window).width()/2,e.pageY=t(window).height()/2+t(window).scrollTop(),r(a)}),t("#lg-zoom-out").on("click.lg",function(){e.core.$outer.find(".lg-current .lg-image").length&&(a-=e.core.s.scale,i())}),t("#lg-zoom-in").on("click.lg",function(){e.core.$outer.find(".lg-current .lg-image").length&&(a+=e.core.s.scale,i())}),t("#lg-actual-size").on("click.lg",function(t){s(t,e.core.$slide.eq(e.core.index).find(".lg-image"),e.core.index,!0)}),e.core.$el.on("onBeforeSlide.lg.tm",function(){a=1,e.resetZoom()}),e.zoomDrag(),e.zoomSwipe()},i.prototype.getCurrentTransform=function(t){if(!t)return 0;var e=window.getComputedStyle(t,null),o=e.getPropertyValue("-webkit-transform")||e.getPropertyValue("-moz-transform")||e.getPropertyValue("-ms-transform")||e.getPropertyValue("-o-transform")||e.getPropertyValue("transform")||"none";return"none"!==o?o.split("(")[1].split(")")[0].split(","):0},i.prototype.getCurrentRotation=function(t){if(!t)return 0;var e=this.getCurrentTransform(t);return e?Math.round(Math.atan2(e[1],e[0])*(180/Math.PI)):0},i.prototype.getModifier=function(t,e,o){var a=t;t=Math.abs(t);var r=this.getCurrentTransform(o);if(!r)return 1;var i=1;if("X"===e){var s=Math.sign(parseFloat(r[0]));0===t||180===t?i=1:90===t&&(i=-90===a&&1===s||90===a&&-1===s?-1:1),i*=s}else{var n=Math.sign(parseFloat(r[3]));if(0===t||180===t)i=1;else if(90===t){var l=parseFloat(r[1]),g=parseFloat(r[2]);i=Math.sign(l*g*a*n)}i*=n}return i},i.prototype.getImageSize=function(t,e,o){return 90===e&&(o="x"===o?"y":"x"),t.prop({y:"offsetHeight",x:"offsetWidth"}[o])},i.prototype.getDragCords=function(t,e){return 90===e?{x:t.pageY,y:t.pageX}:{x:t.pageX,y:t.pageY}},i.prototype.getSwipeCords=function(t,e){var o=t.originalEvent.targetTouches[0].pageX,a=t.originalEvent.targetTouches[0].pageY;return 90===e?{x:a,y:o}:{x:o,y:a}},i.prototype.getPossibleDragCords=function(t,e){var o=(this.core.$outer.find(".lg").height()-this.getImageSize(t,e,"y"))/2,a=Math.abs(this.getImageSize(t,e,"y")*Math.abs(t.attr("data-scale"))-this.core.$outer.find(".lg").height()+o),r=(this.core.$outer.find(".lg").width()-this.getImageSize(t,e,"x"))/2,i=Math.abs(this.getImageSize(t,e,"x")*Math.abs(t.attr("data-scale"))-this.core.$outer.find(".lg").width()+r);return 90===e?{minY:r,maxY:i,minX:o,maxX:a}:{minY:o,maxY:a,minX:r,maxX:i}},i.prototype.getDragAllowedAxises=function(t,e){var o=this.getImageSize(t,e,"y")*t.attr("data-scale")>this.core.$outer.find(".lg").height(),a=this.getImageSize(t,e,"x")*t.attr("data-scale")>this.core.$outer.find(".lg").width();return 90===e?{allowX:o,allowY:a}:{allowX:a,allowY:o}},i.prototype.resetZoom=function(){this.core.$outer.removeClass("lg-zoomed"),this.core.$slide.find(".lg-img-wrap").removeAttr("style data-x data-y"),this.core.$slide.find(".lg-image").removeAttr("style data-scale"),this.pageX=t(window).width()/2,this.pageY=t(window).height()/2+t(window).scrollTop()},i.prototype.zoomSwipe=function(){var t,e=this,o={},a={},r=!1,i=!1,s=!1,n=0;e.core.$slide.on("touchstart.lg",function(a){if(e.core.$outer.hasClass("lg-zoomed")){var r=e.core.$slide.eq(e.core.index).find(".lg-object");t=e.core.$slide.eq(e.core.index).find(".lg-img-rotate")[0],n=e.getCurrentRotation(t);var l=e.getDragAllowedAxises(r,Math.abs(n));s=l.allowY,((i=l.allowX)||s)&&(a.preventDefault(),o=e.getSwipeCords(a,Math.abs(n)))}}),e.core.$slide.on("touchmove.lg",function(l){if(e.core.$outer.hasClass("lg-zoomed")){var g,d,c=e.core.$slide.eq(e.core.index).find(".lg-img-wrap");l.preventDefault(),r=!0,a=e.getSwipeCords(l,Math.abs(n)),e.core.$outer.addClass("lg-zoom-dragging"),d=s?-Math.abs(c.attr("data-y"))+(a.y-o.y)*e.getModifier(n,"Y",t):-Math.abs(c.attr("data-y")),g=i?-Math.abs(c.attr("data-x"))+(a.x-o.x)*e.getModifier(n,"X",t):-Math.abs(c.attr("data-x")),(Math.abs(a.x-o.x)>15||Math.abs(a.y-o.y)>15)&&(e.core.s.useLeftForZoom?c.css({left:g+"px",top:d+"px"}):c.css("transform","translate3d("+g+"px, "+d+"px, 0)"))}}),e.core.$slide.on("touchend.lg",function(){e.core.$outer.hasClass("lg-zoomed")&&r&&(r=!1,e.core.$outer.removeClass("lg-zoom-dragging"),e.touchendZoom(o,a,i,s,n))})},i.prototype.zoomDrag=function(){var e,o=this,a={},r={},i=!1,s=!1,n=!1,l=!1,g=0;o.core.$slide.on("mousedown.lg.zoom",function(r){e=o.core.$slide.eq(o.core.index).find(".lg-img-rotate")[0],g=o.getCurrentRotation(e);var s=o.core.$slide.eq(o.core.index).find(".lg-object"),d=o.getDragAllowedAxises(s,Math.abs(g));l=d.allowY,n=d.allowX,o.core.$outer.hasClass("lg-zoomed")&&t(r.target).hasClass("lg-object")&&(n||l)&&(r.preventDefault(),a=o.getDragCords(r,Math.abs(g)),i=!0,o.core.$outer.scrollLeft+=1,o.core.$outer.scrollLeft-=1,o.core.$outer.removeClass("lg-grab").addClass("lg-grabbing"))}),t(window).on("mousemove.lg.zoom",function(t){if(i){var d,c,u=o.core.$slide.eq(o.core.index).find(".lg-img-wrap");s=!0,r=o.getDragCords(t,Math.abs(g)),o.core.$outer.addClass("lg-zoom-dragging"),c=l?-Math.abs(u.attr("data-y"))+(r.y-a.y)*o.getModifier(g,"Y",e):-Math.abs(u.attr("data-y")),d=n?-Math.abs(u.attr("data-x"))+(r.x-a.x)*o.getModifier(g,"X",e):-Math.abs(u.attr("data-x")),o.core.s.useLeftForZoom?u.css({left:d+"px",top:c+"px"}):u.css("transform","translate3d("+d+"px, "+c+"px, 0)")}}),t(window).on("mouseup.lg.zoom",function(t){i&&(i=!1,o.core.$outer.removeClass("lg-zoom-dragging"),!s||a.x===r.x&&a.y===r.y||(r=o.getDragCords(t,Math.abs(g)),o.touchendZoom(a,r,n,l,g)),s=!1),o.core.$outer.removeClass("lg-grabbing").addClass("lg-grab")})},i.prototype.touchendZoom=function(t,e,o,a,r){var i=this.core.$slide.eq(this.core.index).find(".lg-img-wrap"),s=this.core.$slide.eq(this.core.index).find(".lg-object"),n=this.core.$slide.eq(this.core.index).find(".lg-img-rotate")[0],l=-Math.abs(i.attr("data-x"))+(e.x-t.x)*this.getModifier(r,"X",n),g=-Math.abs(i.attr("data-y"))+(e.y-t.y)*this.getModifier(r,"Y",n),d=this.getPossibleDragCords(s,Math.abs(r));(Math.abs(e.x-t.x)>15||Math.abs(e.y-t.y)>15)&&(a&&(g<=-d.maxY?g=-d.maxY:g>=-d.minY&&(g=-d.minY)),o&&(l<=-d.maxX?l=-d.maxX:l>=-d.minX&&(l=-d.minX)),a?i.attr("data-y",Math.abs(g)):g=-Math.abs(i.attr("data-y")),o?i.attr("data-x",Math.abs(l)):l=-Math.abs(i.attr("data-x")),this.core.s.useLeftForZoom?i.css({left:l+"px",top:g+"px"}):i.css("transform","translate3d("+l+"px, "+g+"px, 0)"))},i.prototype.destroy=function(){this.core.$el.off(".lg.zoom"),t(window).off(".lg.zoom"),this.core.$slide.off(".lg.zoom"),this.core.$el.off(".lg.tm.zoom"),this.resetZoom(),clearTimeout(this.zoomabletimeout),this.zoomabletimeout=!1},t.fn.lightGallery.modules.zoom=i});
//# sourceMappingURL=../sourcemaps/modules/zoom.js.map
